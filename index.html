<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kesehatan Mental</title>

  <link rel="stylesheet" href="style.css">

  <style>
    /* ==============================
       BASE OVERRIDES: tetap jaga struktur awal
       ============================== */
    * { box-sizing: border-box; margin:0; padding:0; font-family: "Poppins", "Segoe UI", Roboto, sans-serif; }
    /* Warna font default (Blue/Pink Gradient) akan menggunakan Dark Blue/Pink Gradient */
    body { color: #3a5fbf; line-height:1.6; min-height:100vh; position:relative; overflow-x:hidden; transition: color .4s ease, background-color .3s ease; }

    body::before{
      content: "";
      position: fixed;
      inset: 0;
      z-index: -100;
      background: linear-gradient(135deg, #f7f9ff 0%, #f2f7ff 40%, #fff4fb 100%);
      transition: background .4s ease;
    }

    /* Header - sekarang bergradien biru->pink (tetap kotak) */
    header {
      background: linear-gradient(90deg, #7aa3ff 0%, #ffb3d9 100%);
      padding: 1rem 0;
      text-align: center;
      position: relative;
      overflow: visible;
      transition: background .4s ease;
    }
    header h1 { margin-bottom: 8px; font-size: 1.8rem; color: #3a5fbf; } /* Dark Blue for Default */

    nav ul { list-style:none; display:flex; justify-content:center; gap:18px; flex-wrap:wrap; margin-top:6px; }
    nav ul li a { text-decoration:none; font-weight:600; padding:6px 8px; display:inline-block; color: #3a5fbf; } /* Dark Blue for Default */
    nav ul li a:hover { text-decoration:underline; }

    section { padding: 40px 20px; max-width: 900px; margin: 20px auto; background: transparent; }

    /* H2 - Default to Dark Blue/Pink Gradient */
    h2 {
      margin-bottom:10px;
      transition: all .4s ease; /* Tambahkan transisi untuk tema */
      /* Dark Blue/Pink Gradient for Default H2/Accent */
      background: linear-gradient(90deg, #3a5fbf 0%, #c4407b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
    }

    form { margin-top:20px; background: white; padding:18px; border-radius:12px; box-shadow: 0 6px 18px rgba(30,40,80,0.06); }

    .question { margin-bottom:12px; }
    /* INPUT NUMBER STYLE */
    input[type="number"] {
      padding:8px;
      border-radius:6px;
      border:1px solid #ddd;
      width: 60px; /* Ukuran kecil */
      text-align: center;
      -moz-appearance: textfield; /* Hide arrows in Firefox */
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none; /* Hide arrows in Chrome/Safari */
      margin: 0;
    }
    
    button, .btn {
      background: #9ebdff;
      color:white;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      position:relative;
      overflow:visible;
      transition: transform .12s ease, box-shadow .12s ease, background .4s ease, color .4s ease;
    }
    button:hover, .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(32,48,120,0.12); }

    #hasil { margin-top:18px; background:#eaf2ff; padding:14px; border-radius:10px; }

    footer { text-align:center; background:transparent; color:inherit; padding:18px 10px; margin-top:40px; }

    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(30,40,80,0.05);
      height: 100%;
    }

    .question-label {
        color: inherit; /* Pastikan label mengikuti warna body */
    }

    /* Tata letak grid untuk pertanyaan */
    .questions-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:15px; /* Tambah gap */
    }
    /* Style untuk form pertanyaan */
    .question-item {
        display:flex;
        flex-direction:column;
        gap:6px;
    }
    .question-label {
        display:block;
        font-weight:600;
        margin-bottom:4px;
        color: inherit;
    }
    .score-control {
        display:flex;
        gap:8px;
        align-items:center;
    }
    
    /* ==============================
       NEW CAROUSEL STYLES
       ============================== */
    #quotes-section {
        padding: 0; /* No padding here, content inside will have it */
        border-radius:12px;
        background: none; 
        box-shadow: none;
        overflow: hidden; 
        position: relative;
    }

    .carousel-container {
        position: relative;
        max-width: 700px; /* Lebar maksimum carousel */
        margin: 0 auto;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        overflow: hidden; 
    }

    .carousel-slides {
        display: flex;
        transition: transform 0.5s ease-in-out;
        border-radius: 15px;
    }

    .carousel-slide {
        min-width: 100%; /* Setiap slide memenuhi lebar kontainer */
        box-sizing: border-box;
        position: relative;
        overflow: hidden;
        border-radius: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: #333; /* Warna teks default untuk slide */
    }

    .carousel-slide img {
        width: 100%;
        height: 300px; /* Tinggi gambar carousel */
        object-fit: cover; 
        display: block;
        border-radius: 15px;
    }

    .carousel-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.7); /* Latar belakang transparan untuk teks */
        padding: 20px;
        border-bottom-left-radius: 15px;
        border-bottom-right-radius: 15px;
        font-weight: 600;
        font-size: 1.1em;
        line-height: 1.4;
        color: #3a5fbf; /* Default caption color */
        text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }
    .carousel-caption p { margin: 0; }

    .carousel-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.5);
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 1.5em;
        color: #333;
        border-radius: 50%;
        z-index: 10;
        transition: background 0.3s ease;
    }
    .carousel-nav-btn:hover { background: rgba(255, 255, 255, 0.8); }
    .carousel-nav-btn.prev { left: 10px; }
    .carousel-nav-btn.next { right: 10px; }

    .carousel-dots {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
    }
    .carousel-dot {
        width: 10px;
        height: 10px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .carousel-dot.active {
        background: #ffb3d9; /* Pink dot for active slide */
        width: 12px;
        height: 12px;
    }

    /* Theme chooser: DROPDOWN style - Sekarang di Nav */
    .theme-chooser {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 6px 0; /* Padding agar sejajar dengan link navigasi */
    }
    .theme-chooser select {
      padding:4px 8px; /* Dikecilkan agar pas di nav */
      border-radius:8px; border:1px solid #ddd; background-color:white; cursor:pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.05);
      min-width: 130px;
      appearance: auto;
      font-size: 0.9rem;
    }
    
    /* Style untuk label tema di header (agar mengikuti warna link) */
    header nav .theme-chooser label {
        font-size: 0.9rem;
        font-weight: 600;
        color: #3a5fbf; /* Default Dark Blue */
        white-space: nowrap;
    }


    /* ==============================
       Theme Specific Styles (Dark Font Colors)
       ============================== */
    /* Pastel Pink Theme */
    body[data-theme="pink"] { color: #7d445c; } /* Dark Pink for all text */
    header[data-theme="pink"] h1, header[data-theme="pink"] nav ul li a, header[data-theme="pink"] nav .theme-chooser label { color: #7d445c; }
    h2[data-theme="pink"] {
        color: #c4407b; 
        background: none;
        -webkit-text-fill-color: initial;
        background-clip: initial;
    }
    .carousel-caption[data-theme="pink"] { color: #7d445c; }
    .carousel-dot[data-theme="pink"].active { background: #c4407b; }


    /* Pastel Blue Theme */
    body[data-theme="blue"] { color: #30538a; } /* Dark Blue for all text */
    header[data-theme="blue"] h1, header[data-theme="blue"] nav ul li a, header[data-theme="blue"] nav .theme-chooser label { color: #30538a; }
    h2[data-theme="blue"] {
        color: #1a407a; 
        background: none;
        -webkit-text-fill-color: initial;
        background-clip: initial;
    }
    .carousel-caption[data-theme="blue"] { color: #30538a; }
    .carousel-dot[data-theme="blue"].active { background: #1a407a; }


    /* Pastel Purple Theme */
    body[data-theme="purple"] { color: #53308a; } /* Dark Purple for all text */
    header[data-theme="purple"] h1, header[data-theme="purple"] nav ul li a, header[data-theme="purple"] nav .theme-chooser label { color: #53308a; }
    h2[data-theme="purple"] {
        color: #6035b3; 
        background: none;
        -webkit-text-fill-color: initial;
        background-clip: initial;
    }
    .carousel-caption[data-theme="purple"] { color: #53308a; }
    .carousel-dot[data-theme="purple"].active { background: #6035b3; }


    /* Gradient Rainbow Theme */
    body[data-theme="rainbow"] { color: #333; } /* Base color dark */
    header[data-theme="rainbow"] h1, header[data-theme="rainbow"] nav ul li a, header[data-theme="rainbow"] nav .theme-chooser label { color: #333; }
    h2[data-theme="rainbow"] {
        /* Dark Rainbow Gradient for headings/accents */
        background: linear-gradient(90deg, #b3579b, #3a5fbf, #53308a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        color: initial;
    }
    .carousel-caption[data-theme="rainbow"] { color: #333; }
    .carousel-dot[data-theme="rainbow"].active { background: linear-gradient(90deg, #b3579b, #3a5fbf); }


    /* Override button styling for themes */
    button[data-theme="pink"], .btn[data-theme="pink"] { background: #ffb3d9; color: #333; }
    button[data-theme="blue"], .btn[data-theme="blue"] { background: #7aa3ff; color: white; }
    button[data-theme="purple"], .btn[data-theme="purple"] { background: #b380ff; color: white; }
    button[data-theme="rainbow"], .btn[data-theme="rainbow"] { background: linear-gradient(90deg,#ffd6f0,#dbe9ff); color: #333; }

    /* ==============================
       Small responsiveness
       ============================== */
    @media (max-width:720px){
      header h1 { font-size:1.4rem; }
      nav ul { gap:10px; font-size:0.95rem; }
      .cloud.c1, .cloud.c2, .cloud.c3 { display:block; opacity:.6; }
      .questions-grid { grid-template-columns: 1fr; } /* Satu kolom di layar kecil */
    }
    @media (max-width: 550px) {
        nav ul { flex-direction: column; gap: 5px; } /* Susun vertikal jika layar terlalu sempit */
        .theme-chooser { justify-content: center; }
    }

  </style>
</head>
<body>

  <div class="clouds" aria-hidden="true">
    <div class="cloud c1" style="left:-30%; top:8%;"></div>
    <div class="cloud c2" style="left:-40%; top:38%;"></div>
    <div class="cloud c3" style="left:-50%; top:68%;"></div>
  </div>

  <header id="main-header">
    <div class="sparkle s1" aria-hidden="true"></div>
    <div class="sparkle s2" aria-hidden="true"></div>
    <div class="sparkle s3" aria-hidden="true"></div>

    <h1>Kesehatan Mental</h1>

    <nav>
      <ul>
        <li><a href="#pencegahan">Pencegahan</a></li>
        <li><a href="#tanda">Tanda-tanda</a></li>
        <li><a href="#mengatasi">Mengatasi</a></li>
        <li><a href="#angket">Tes Mental</a></li>
        <li class="theme-menu-item">
            <div class="theme-chooser">
                <label for="theme-select">Tema:</label>
                <select id="theme-select" aria-label="Pilih tema warna">
                    <option value="default">Default (Blue/Pink)</option>
                    <option value="pink">Pastel Pink</option>
                    <option value="blue">Pastel Blue</option>
                    <option value="purple">Pastel Purple</option>
                    <option value="rainbow">Gradient Rainbow</option>
                </select>
            </div>
        </li>
      </ul>
    </nav>
  </header>

  <section id="pencegahan">
    <h2 id="h2-pencegahan">Cara Pencegahan Gangguan Mental</h2>
    <ul>
      <li>Menjaga keseimbangan antara pekerjaan dan istirahat.</li>
      <li>Berolahraga secara teratur.</li>
      <li>Menjaga pola makan sehat dan tidur cukup.</li>
      <li>Berbicara dengan orang yang dipercaya saat menghadapi stres.</li>
      <li>Hindari konsumsi alkohol dan narkoba.</li>
    </ul>
  </section>

  <section id="tanda">
    <h2 id="h2-tanda">Tanda-tanda Gangguan Mental</h2>
    <ul>
      <li>Merasa sedih atau cemas berkepanjangan.</li>
      <li>Kehilangan minat terhadap aktivitas yang disukai.</li>
      <li>Perubahan nafsu makan atau pola tidur.</li>
      <li>Sulit berkonsentrasi.</li>
      <li>Menarik diri dari lingkungan sosial.</li>
    </ul>
  </section>

  <section id="mengatasi">
    <h2 id="h2-mengatasi">Cara Mengatasi Gangguan Mental</h2>
    <ul>
      <li>Konsultasi dengan psikolog atau psikiater.</li>
      <li>Terapi perilaku kognitif atau konseling.</li>
      <li>Menulis jurnal atau meditasi.</li>
      <li>Meningkatkan dukungan sosial.</li>
      <li>Berpartisipasi dalam kegiatan positif.</li>
    </ul>
  </section>

  <section id="angket">
    <h2 id="h2-angket">Tes Kesehatan Mental</h2>

    <button id="toggle-test-btn" class="btn" style="margin-bottom:20px;">
        Mulai Tes Kesehatan <span class="toggle-icon">‚ñº</span>
    </button>

    <div id="test-content-container" class="card" style="display:none;">
      
        <div>
            <div class="tests-tabs" role="tablist" aria-label="Pilih tes" style="margin-bottom: 14px;">
                <button class="tab active" data-test="stres">Tes Stres (15)</button>
                <button class="tab" data-test="kecemasan">Tes Kecemasan</button>
                <button class="tab" data-test="kebahagiaan">Tes Kebahagiaan</button>
                <button class="tab" data-test="keseimbangan">Tes Keseimbangan Hidup</button>
            </div>
            
            <div id="panels" style="margin-top:14px;">
                <div class="test-panel active" data-testpanel="stres">
                    <form class="test-form" data-questions="15">
                        <div style="display:flex;flex-direction:column;gap:15px;">
                            <div class="questions-grid">
                                </div>
                            <div style="display:flex;gap:10px; margin-top:8px;">
                                <button type="submit" class="btn" id="submitStres">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="test-panel" data-testpanel="kecemasan">
                    <form class="test-form" data-questions="10">
                        <div style="display:flex;flex-direction:column;gap:15px;">
                            <div class="questions-grid"></div>
                            <div style="display:flex;gap:10px; margin-top:8px;">
                                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="test-panel" data-testpanel="kebahagiaan">
                    <form class="test-form" data-questions="8">
                        <div style="display:flex;flex-direction:column;gap:15px;">
                            <div class="questions-grid"></div>
                            <div style="display:flex;gap:10px; margin-top:8px;">
                                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="test-panel" data-testpanel="keseimbangan">
                    <form class="test-form" data-questions="12">
                        <div style="display:flex;flex-direction:column;gap:15px;">
                            <div class="questions-grid"></div>
                            <div style="display:flex;gap:10px; margin-top:8px;">
                                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div id="hasil-area" style="margin-top:16px; display:none;" class="card">
                <h3 id="hasil-title">Hasil Tes</h3>
                <p id="hasil-emoji" style="font-size:2rem; margin:8px 0;">üôÇ</p>
                <p id="hasil-score" style="font-weight:700;"></p>
                <p id="hasil-interpretasi"></p>
                <div style="margin-top:8px; display:flex; gap:8px;">
                    <button class="btn" id="saveLocal">Simpan Hasil <span class="hover-ico">‚ô°</span></button>
                    <button class="btn" id="downloadResult" style="background:#fff;color:#333;border:1px solid #eee;">Download <span class="hover-ico">‚ú®</span></button>
                </div>
            </div>
        </div>
    </div>
  </section>

  <section id="quotes" style="max-width:980px;margin:30px auto;">
    <h2 id="h2-quotes">Motivasi Visual Aesthetic</h2>
    <div id="quotes-section">
      <div class="carousel-container">
        <div class="carousel-slides">
            <div class="carousel-slide">
                <img src="https://images.unsplash.com/photo-1518066000714-cdcd82531732?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Cloud pastel">
                <div class="carousel-caption">
                    <p>Setiap awan gelap pasti berlalu.</p>
                </div>
            </div>
            <div class="carousel-slide">
                <img src="https://images.unsplash.com/photo-1542401886-65d6c61d56e8?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Hati pastel">
                <div class="carousel-caption">
                    <p>Cintai dirimu, selalu.</p>
                </div>
            </div>
            <div class="carousel-slide">
                <img src="https://images.unsplash.com/photo-1533167732292-3c1a32997184?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Bunga lembut pastel">
                <div class="carousel-caption">
                    <p>Tumbuhlah, seperti bunga yang mekar.</p>
                </div>
            </div>
            <div class="carousel-slide">
                <img src="https://images.unsplash.com/photo-1528459463991-8c4187019803?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Sunset pastel">
                <div class="carousel-caption">
                    <p>Indahnya dirimu, sama seperti senja.</p>
                </div>
            </div>
            <div class="carousel-slide">
                <img src="https://images.unsplash.com/photo-1517833503254-0f3b0e3e5c9f?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Dreamy pastel gradient">
                <div class="carousel-caption">
                    <p>Mimpi adalah nyata, percayalah.</p>
                </div>
            </div>
        </div>
        <button class="carousel-nav-btn prev">‚ùÆ</button>
        <button class="carousel-nav-btn next">‚ùØ</button>
        <div class="carousel-dots"></div>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 Kesehatan Mental | Dibuat dengan ‚ù§Ô∏è</p>
  </footer>

  <script>
    /**********************
     * UTIL: questions templates (placeholder texts)
     **********************/
    const sampleQs = {
      stres: [
        "Saya merasa mudah marah atau tersinggung.",
        "Saya sulit rileks.",
        "Saya merasa tertekan dengan tuntutan sehari-hari.",
        "Pikiran saya sering berputar tanpa henti.",
        "Saya merasa lelah karena beban pikiran.",
        "Saya mudah terganggu oleh hal kecil.",
        "Saya merasa tidak sabar.",
        "Saya khawatir tidak bisa menyelesaikan tugas.",
        "Saya sering merasa cemas tanpa alasan jelas.",
        "Tidur saya terganggu karena pikiran.",
        "Saya merasa tegang otot atau sakit kepala karena stres.",
        "Saya sulit berkonsentrasi.",
        "Saya khawatir berlebihan tentang masa depan.",
        "Saya merasa kewalahan ketika banyak tugas.",
        "Saya sulit menenangkan diri setelah kejadian menegangkan."
      ],
      kecemasan: [
        "Saya sering merasa cemas tanpa alasan yang jelas.",
        "Saya khawatir berlebihan terhadap hal kecil.",
        "Saya merasa gelisah di keramaian.",
        "Saya sulit tidur karena pikiran cemas.",
        "Saya khawatir tentang kesehatan saya terus-menerus.",
        "Saya merasa napas cepat saat cemas.",
        "Saya menghindari situasi karena takut cemas.",
        "Saya merasa ada yang tidak terkendali.",
        "Saya sering memikirkan kemungkinan terburuk.",
        "Saya sulit menenangkan diri saat khawatir."
      ],
      kebahagiaan: [
        "Saya merasa puas dengan hidup saya saat ini.",
        "Saya mudah merasakan kebahagiaan dalam hal sederhana.",
        "Saya merasa memiliki tujuan yang memotivasi.",
        "Saya merasa dekat dan terhubung dengan orang lain.",
        "Saya menikmati waktu sendirian tanpa merasa sedih.",
        "Saya sering tersenyum tanpa alasan khusus.",
        "Saya bersyukur atas hal-hal kecil setiap hari.",
        "Saya merasa optimis tentang masa depan."
      ],
      keseimbangan: [
        "Saya merasa pekerjaan dan kehidupan pribadi seimbang.",
        "Saya cukup tidur dan istirahat.",
        "Saya punya waktu untuk hobi dan rekreasi.",
        "Saya menjaga pola makan yang baik.",
        "Saya meluangkan waktu untuk olahraga.",
        "Saya merasa hubungan sosial saya sehat.",
        "Saya memiliki waktu untuk refleksi diri.",
        "Saya bisa mengelola stres secara rutin.",
        "Saya merasa punya dukungan saat sulit.",
        "Saya memberi waktu untuk pengembangan diri.",
        "Saya merasa bebas dari beban finansial yang berlebihan.",
        "Saya menikmati kegiatan yang menenangkan."
      ]
    };

    /**********************
     * Render questions into each panel (Using INPUT TYPE="NUMBER")
     **********************/
    document.querySelectorAll('.test-panel').forEach(panel=>{
      const form = panel.querySelector('.test-form');
      const grid = form.querySelector('.questions-grid');
      const qKey = panel.dataset.testpanel;
      const qArr = sampleQs[qKey] || [];
      const questionsCount = parseInt(form.dataset.questions,10) || qArr.length;

      let finalQs = [];
      for (let i=0;i<questionsCount;i++){
        finalQs.push(qArr[i % qArr.length] || `Pertanyaan ${i+1}`);
      }

      grid.innerHTML = '';
      finalQs.forEach((q,i)=>{
        const idx = i+1;
        const item = document.createElement('div');
        item.className = 'card question-item';
        item.innerHTML = `
          <label class="question-label" for="${qKey}-q${idx}">${idx}. ${q}</label>
          <div class="score-control">
            <input type="number" id="${qKey}-q${idx}" name="${qKey}-q${idx}" required min="1" max="5" value="1" data-qindex="${i}">
            <small style="color:inherit;">(Skor 1-5)</small>
          </div>
        `;
        grid.appendChild(item);
      });
    });

    /**********************
     * Toggle Test Content Visibility
     **********************/
    const toggleBtn = document.getElementById('toggle-test-btn');
    const testContainer = document.getElementById('test-content-container');
    const toggleIcon = toggleBtn.querySelector('.toggle-icon');

    toggleBtn.addEventListener('click', () => {
        const isHidden = testContainer.style.display === 'none';
        
        if (isHidden) {
            testContainer.style.display = 'block';
            toggleBtn.innerHTML = 'Sembunyikan Tes Kesehatan <span class="toggle-icon">‚ñ≤</span>';
            // Scroll to the top of the test content area for better UX
            testContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
            testContainer.style.display = 'none';
            toggleBtn.innerHTML = 'Mulai Tes Kesehatan <span class="toggle-icon">‚ñº</span>';
        }
    });

    /**********************
     * Tabs behavior
     **********************/
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const key = t.dataset.test;
        document.querySelectorAll('.test-panel').forEach(p=>{
          p.classList.toggle('active', p.dataset.testpanel === key);
        });
        document.getElementById('hasil-area').style.display = 'none';
        // Reset inputs on switch (optional, but good UX)
        document.querySelectorAll('.test-form input[type="number"]').forEach(s => s.value = 1);
      });
    });

    /**********************
     * Scoring & Interpretation (common function)
     **********************/
    function interpretResult(total, questions, testKey){
      const max = questions*5;
      // we'll compute 'scorePercent' similar: healthier => higher percent (lower total for Stres/Cemas is better)
      const healthyPercent = Math.round(((max - total) / max) * 100);
      let emoji='üôÇ', title='OK', interp='';

      if (testKey === 'kebahagiaan') {
        // For 'kebahagiaan', a higher raw score (total) means better (healthier). We need to invert the formula logic for this test.
        const happinessScore = total; // 8*1 (8) to 8*5 (40)
        const min = questions*1;
        const happyPercent = Math.round(((happinessScore - min) / (max - min)) * 100);

        if (happyPercent >= 80) { emoji='ü§©'; title='Sangat Bahagia'; interp='Kamu merasa sangat bahagia. Pertahankan rasa syukur dan kebiasaan positif.'; }
        else if (happyPercent >= 50) { emoji='üòä'; title='Cukup Bahagia'; interp='Kamu cukup bahagia. Coba rutinitas kecil yang membahagiakan untuk meningkatkannya.'; }
        else { emoji='üòï'; title='Kurang Bahagia'; interp='Pertimbangkan aktivitas yang memberi makna dan meningkatkan hubungan sosial.'; }
        return { emoji, title, interp, healthyPercent: happyPercent }; // Return happyPercent as the score
      }

      // For Stres, Kecemasan, Keseimbangan: lower total = higher healthyPercent
      if (testKey === 'stres') {
        if (healthyPercent >= 80) { emoji='üòå'; title='Stres Rendah'; interp='Kamu tampak punya mekanisme koping yang baik. Pertahankan kebiasaan positif.'; }
        else if (healthyPercent >= 50) { emoji='üôÇ'; title='Stres Sedang'; interp='Perhatikan tanda-tanda stres ‚Äî coba teknik relaksasi seperti bernapas atau jalan singkat.'; }
        else { emoji='üòü'; title='Stres Tinggi'; interp='Kamu mengalami tingkat stres yang cukup tinggi. Pertimbangkan berbicara dengan orang terpercaya atau profesional.'; }
      } else if (testKey === 'kecemasan') {
        if (healthyPercent >= 80) { emoji='üòä'; title='Kecemasan Rendah'; interp='Kecemasanmu rendah. Lanjutkan aktivitas yang menenangkan.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Kecemasan Sedang'; interp='Coba teknik pernapasan, kurangi kafein, dan istirahat cukup.'; }
        else { emoji='üò∞'; title='Kecemasan Tinggi'; interp='Pertimbangkan dukungan lebih lanjut ‚Äî konsultasi profesional dapat membantu.'; }
      } else if (testKey === 'keseimbangan') {
        if (healthyPercent >= 80) { emoji='üåø'; title='Seimbang'; interp='Kehidupanmu tampak seimbang. Jaga konsistensi dan istirahat.'; }
        else if (healthyPercent >= 50) { emoji='‚öñÔ∏è'; title='Cukup Seimbang'; interp='Perhatikan area yang kurang ‚Äî coba atur jadwal dan kurangi beban.'; }
        else { emoji='üîÑ'; title='Kurang Seimbang'; interp='Pertimbangkan langkah sederhana: tidur, olahraga ringan, dan dukungan sosial.'; }
      } else {
        // Fallback for any other test
        if (healthyPercent >= 80) { emoji='üôÇ'; title='Baik'; interp='Hasil menunjukkan kondisi yang cukup baik.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Perlu Perhatian'; interp='Perlu beberapa perbaikan.'; }
        else { emoji='üòü'; title='Perhatian Lebih'; interp='Disarankan untuk mencari dukungan.'; }
      }

      return { emoji, title, interp, healthyPercent };
    }


    /**********************
     * Handle form submissions for all tests
     **********************/
    document.querySelectorAll('.test-form').forEach(form=>{
      form.addEventListener('submit', function(e){
        e.preventDefault();
        // Use number inputs
        const inputs = Array.from(form.querySelectorAll('input[type="number"]'));

        // Check for required fields and value range
        let total = 0;
        let isValid = true;
        inputs.forEach(inp => {
            let v = parseInt(inp.value,10);
            if (isNaN(v) || v < 1 || v > 5) {
                isValid = false;
                inp.style.border = '2px solid red'; // Highlight invalid input
            } else {
                inp.style.border = '1px solid #ddd'; // Reset border
                total += v;
            }
        });

        if (!isValid) {
            alert("Harap isi semua pertanyaan dengan skor antara 1 sampai 5.");
            return;
        }

        const activePanel = form.closest('.test-panel');
        const testKey = activePanel ? activePanel.dataset.testpanel : 'test';
        const questions = inputs.length;

        const res = interpretResult(total, questions, testKey);

        // show hasil-area
        document.getElementById('hasil-area').style.display = 'block';
        document.getElementById('hasil-title').textContent = res.title + ' ‚Äî ' + testKey.charAt(0).toUpperCase() + testKey.slice(1);
        document.getElementById('hasil-emoji').textContent = res.emoji;
        document.getElementById('hasil-score').textContent = `Skor kesehatan (lebih tinggi = lebih baik): ${res.healthyPercent}%`;
        document.getElementById('hasil-interpretasi').textContent = res.interp;

        // store last result in DOM for save/download
        document.getElementById('hasil-area').dataset.lastResult = JSON.stringify({
          testKey, total, questions, ...res, timestamp: new Date().toISOString()
        });

        // scroll into view
        document.getElementById('hasil-area').scrollIntoView({behavior:'smooth'});
      });
    });

    /**********************
     * Reset buttons per panel
     **********************/
    document.querySelectorAll('.btn-reset').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const form = btn.closest('.test-panel').querySelector('.test-form');
        // Reset input value to 1
        form.querySelectorAll('input[type="number"]').forEach(i=>{
            i.value = 1;
            i.style.border = '1px solid #ddd'; // Reset border
        });
        document.getElementById('hasil-area').style.display = 'none';
      });
    });

    /**********************
     * Save result locally (localStorage)
     **********************/
    document.getElementById('saveLocal').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk disimpan.'); return; }
      const results = JSON.parse(localStorage.getItem('mh_results') || '[]');
      results.push(JSON.parse(last));
      localStorage.setItem('mh_results', JSON.stringify(results));
      alert('Hasil tersimpan (local).');
    });

    /**********************
     * Download result as text
     **********************/
    document.getElementById('downloadResult').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk didownload.'); return; }
      const data = JSON.parse(last);
      const content = `Hasil Tes: ${data.testKey}\nWaktu: ${data.timestamp}\nSkor: ${data.healthyPercent}%\nInterpretasi: ${data.interp}\nEmoji: ${data.emoji}\n`;
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `hasil-${data.testKey}.txt`; document.body.appendChild(a);
      a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    /**********************
     * CAROUSEL SCRIPT
     **********************/
    const slidesContainer = document.querySelector('.carousel-slides');
    const slides = document.querySelectorAll('.carousel-slide');
    const prevButton = document.querySelector('.carousel-nav-btn.prev');
    const nextButton = document.querySelector('.carousel-nav-btn.next');
    const dotsContainer = document.querySelector('.carousel-dots');
    const body = document.body; // Used for theme retrieval

    let currentIndex = 0;
    let autoSlideInterval;

    // 1. Create Dots
    slides.forEach((_, i) => {
        const dot = document.createElement('span');
        dot.classList.add('carousel-dot');
        dot.setAttribute('data-index', i);
        dotsContainer.appendChild(dot);
        dot.addEventListener('click', () => {
            showSlide(i);
            resetAutoSlide();
        });
    });

    const dots = document.querySelectorAll('.carousel-dot');

    // 2. Main Slide Function
    function showSlide(index) {
        if (index >= slides.length) {
            index = 0;
        } else if (index < 0) {
            index = slides.length - 1;
        }
        currentIndex = index;
        
        // Update slides position
        slidesContainer.style.transform = `translateX(-${currentIndex * 100}%)`;

        // Update dots (handling theme for dot color)
        dots.forEach(dot => {
            dot.classList.remove('active');
            dot.removeAttribute('data-theme');
        });

        const activeDot = dots[currentIndex];
        const currentTheme = body.getAttribute('data-theme');

        if (activeDot) {
            activeDot.classList.add('active');
            if (currentTheme) {
                 activeDot.setAttribute('data-theme', currentTheme);
            }
        }
    }

    // 3. Navigation Controls