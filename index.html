<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kesehatan Mental</title>

  <link rel="stylesheet" href="style.css">

  <style>
    /* ==============================
       BASE OVERRIDES: tetap jaga struktur awal
       ============================== */
    * { box-sizing: border-box; margin:0; padding:0; font-family: "Poppins", "Segoe UI", Roboto, sans-serif; }
    body { color: #333; line-height:1.6; min-height:100vh; position:relative; overflow-x:hidden; transition: background-color .3s ease; }

    /* Pastel background utama + slow gradient */
    body::before{
      content: "";
      position: fixed;
      inset: 0;
      z-index: -100;
      background: linear-gradient(135deg, #f7f9ff 0%, #f2f7ff 40%, #fff4fb 100%);
      transition: background .4s ease; /* Tambahkan transisi untuk tema */
    }

    /* Header - sekarang bergradien biru->pink (tetap kotak) */
    header {
      background: linear-gradient(90deg, #7aa3ff 0%, #ffb3d9 100%);
      color: white;
      padding: 1rem 0;
      text-align: center;
      position: relative;
      overflow: visible;
      transition: background .4s ease; /* Tambahkan transisi untuk tema */
    }
    header h1 { margin-bottom: 8px; font-size: 1.8rem; }

    nav ul { list-style:none; display:flex; justify-content:center; gap:18px; flex-wrap:wrap; margin-top:6px; }
    nav ul li a { color:white; text-decoration:none; font-weight:600; padding:6px 8px; display:inline-block; }

    section { padding: 40px 20px; max-width: 900px; margin: 20px auto; background: transparent; }

    h2 { color: #7aa3ff; margin-bottom:10px; transition: color .4s ease; /* Tambahkan transisi untuk tema */ }

    form { margin-top:20px; background: white; padding:18px; border-radius:12px; box-shadow: 0 6px 18px rgba(30,40,80,0.06); }

    .question { margin-bottom:12px; }
    /* input[type="number"] diganti select */
    select { padding:8px; border-radius:6px; border:1px solid #ddd; appearance:none; background-color:white; cursor:pointer;}

    button, .btn {
      background: #9ebdff;
      color:white;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      position:relative;
      overflow:visible;
      transition: transform .12s ease, box-shadow .12s ease, background .4s ease, color .4s ease;
    }
    button:hover, .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(32,48,120,0.12); }

    #hasil { margin-top:18px; background:#eaf2ff; padding:14px; border-radius:10px; }

    footer { text-align:center; background:transparent; color:#666; padding:18px 10px; margin-top:40px; }

    /* ==============================
       Cute icon on hover (‚ú® / ‚ô°)
       ============================== */
    .btn .hover-ico, button .hover-ico {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%) translateX(6px);
      opacity: 0;
      pointer-events:none;
      transition: transform .25s cubic-bezier(.2,.9,.3,1), opacity .2s;
      font-size:18px;
    }
    button:hover .hover-ico, .btn:hover .hover-ico { opacity:1; transform: translateY(-50%) translateX(0); }

    /* Slight pastel shadows for cards */
    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(30,40,80,0.05);
      height: 100%; /* Penting untuk grid item */
    }

    /* ==============================
       Multiple tests layout (tabs)
       ============================== */
    .tests-tabs { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px; }
    .tab {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      padding:8px 12px;
      border-radius:999px;
      backdrop-filter: blur(6px);
      cursor:pointer;
      color:#3a5fbf;
      font-weight:600;
    }
    .tab.active { background:linear-gradient(90deg,#9ebdff,#ffb3d9); color:white; }

    .test-panel { display:none; }
    .test-panel.active { display:block; }

    /* Tata letak grid untuk pertanyaan */
    .questions-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:15px; /* Tambah gap */
    }
    /* Style untuk form pertanyaan */
    .question-item {
        display:flex;
        flex-direction:column;
        gap:6px;
    }
    .question-label {
        display:block;
        font-weight:600;
        margin-bottom:4px;
        color: #555;
    }
    .score-control {
        display:flex;
        gap:8px;
        align-items:center;
    }

    /* ==============================
       QUOTES DISPLAY (non-slider)
       ============================== */
    #quotes-section { padding: 30px 20px; border-radius:12px; background: linear-gradient(180deg,#fff8fe,#f7fbff); box-shadow: 0 6px 18px rgba(30,40,80,0.03); transition: background .4s ease; }
    .quote-display { max-width:700px; margin:0 auto; min-height:100px; text-align:center; padding:10px; }
    #current-quote { color:#333; font-weight:600; font-size:1.1rem; line-height:1.5; margin-bottom:10px; }
    #quote-author { color:#7aa3ff; font-style:italic; font-weight:500; font-size:0.95rem; }

    /* ==============================
       Clouds animation (soft) - fixed in background
       ============================== */
    .clouds {
      position: fixed;
      inset: 0;
      z-index: -90;
      pointer-events: none;
      overflow: hidden;
    }
    .cloud {
      position: absolute;
      background: linear-gradient(180deg,#ffffffcc,#fff0ffcc);
      border-radius: 50%;
      filter: blur(6px);
      opacity: .85;
      animation: floatCloud 40s linear infinite;
      transform: translateY(0);
    }
    .cloud.c1 { width: 360px; height:110px; top: 20%; left:-20%; animation-duration:48s; }
    .cloud.c2 { width: 260px; height:80px; top: 40%; left:-30%; animation-duration:60s; animation-delay:5s; }
    .cloud.c3 { width: 420px; height:130px; top: 70%; left:-40%; animation-duration:72s; animation-delay:8s; }
    @keyframes floatCloud {
      0% { transform: translateX(-10vw) translateY(0); }
      50% { transform: translateX(110vw) translateY(-8px); }
      100% { transform: translateX(230vw) translateY(0); }
    }

    /* ==============================
       Header sparkles
       ============================== */
    .sparkle {
      position: absolute;
      width:8px; height:8px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #fff7 20%, transparent 60%);
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(255,255,255,0.6);
      opacity: .9;
      transform-origin:center;
      animation: sparkleAnim 2.6s linear infinite;
      pointer-events:none;
    }
    .sparkle.s1 { top: 16px; left: 12%; animation-delay:0s; }
    .sparkle.s2 { top: 8px; left: 24%; animation-delay:.6s; }
    .sparkle.s3 { top: 24px; left: 70%; animation-delay:1.1s; }
    @keyframes sparkleAnim {
      0% { transform: scale(.6) translateY(0); opacity:.2; }
      40% { transform: scale(1.6) translateY(-6px); opacity:1; }
      100% { transform: scale(.6) translateY(0); opacity:.2; }
    }

    /* ==============================
       Theme chooser (Dropdown)
       ============================== */
    .theme-chooser { display:flex; gap:8px; align-items:center; justify-content:center; margin:14px 0; }
    .theme-chooser select {
      padding:8px 12px; border-radius:8px; border:1px solid #ddd; background-color:white; cursor:pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.05);
      min-width: 180px;
    }

    /* ==============================
       Theme Specific Styles
       ============================== */
    /* DEFAULT THEME (Blue/Pink - CSS/JS will handle) */

    /* Pastel Pink Theme */
    body[data-theme="pink"]::before { background: linear-gradient(135deg, #fff7fa 0%, #ffe9f4 100%); }
    header[data-theme="pink"] { background: linear-gradient(90deg, #ffb3d9 0%, #ff80b3 100%); }
    h2[data-theme="pink"] { color: #ff80b3; }
    .tab.active[data-theme="pink"] { background: linear-gradient(90deg, #ffb3d9, #ff80b3); }

    /* Pastel Blue Theme */
    body[data-theme="blue"]::before { background: linear-gradient(135deg, #f7fbff 0%, #e9f4ff 100%); }
    header[data-theme="blue"] { background: linear-gradient(90deg, #7aa3ff 0%, #4f8aff 100%); }
    h2[data-theme="blue"] { color: #4f8aff; }
    .tab.active[data-theme="blue"] { background: linear-gradient(90deg, #7aa3ff, #4f8aff); }

    /* Pastel Purple Theme */
    body[data-theme="purple"]::before { background: linear-gradient(135deg, #fbf7ff 0%, #f4e9ff 100%); }
    header[data-theme="purple"] { background: linear-gradient(90deg, #b380ff 0%, #804fff 100%); }
    h2[data-theme="purple"] { color: #804fff; }
    .tab.active[data-theme="purple"] { background: linear-gradient(90deg, #b380ff, #804fff); }

    /* Gradient Rainbow Theme */
    body[data-theme="rainbow"]::before { background: linear-gradient(135deg,#fff6fb 0%,#f0fbff 50%,#fffdf6 100%); }
    header[data-theme="rainbow"] { background: linear-gradient(90deg,#ffd6f0,#dbe9ff,#e8fef8,#fff7d6,#ffdfe8); }
    header[data-theme="rainbow"] h1 { color: #333; }
    header[data-theme="rainbow"] nav ul li a { color: #333; }
    h2[data-theme="rainbow"] { color: #3a5fbf; } /* Blue tone for contrast */
    .tab.active[data-theme="rainbow"] { background: linear-gradient(90deg,#ffd6f0,#dbe9ff); }


    /* Override button styling for themes */
    button[data-theme="pink"], .btn[data-theme="pink"] { background: #ffb3d9; color: #333; }
    button[data-theme="blue"], .btn[data-theme="blue"] { background: #7aa3ff; color: white; }
    button[data-theme="purple"], .btn[data-theme="purple"] { background: #b380ff; color: white; }
    button[data-theme="rainbow"], .btn[data-theme="rainbow"] { background: linear-gradient(90deg,#ffd6f0,#dbe9ff); color: #333; }

    /* ==============================
       Small responsiveness
       ============================== */
    @media (max-width:720px){
      header h1 { font-size:1.4rem; }
      nav ul { gap:10px; font-size:0.95rem; }
      .cloud.c1, .cloud.c2, .cloud.c3 { display:block; opacity:.6; }
      .questions-grid { grid-template-columns: 1fr; } /* Satu kolom di layar kecil */
    }

  </style>
</head>
<body>

  <div class="clouds" aria-hidden="true">
    <div class="cloud c1" style="left:-30%; top:8%;"></div>
    <div class="cloud c2" style="left:-40%; top:38%;"></div>
    <div class="cloud c3" style="left:-50%; top:68%;"></div>
  </div>

  <header id="main-header">
    <div class="sparkle s1" aria-hidden="true"></div>
    <div class="sparkle s2" aria-hidden="true"></div>
    <div class="sparkle s3" aria-hidden="true"></div>

    <h1>Kesehatan Mental</h1>

    <nav>
      <ul>
        <li><a href="#pencegahan">Pencegahan</a></li>
        <li><a href="#tanda">Tanda-tanda</a></li>
        <li><a href="#mengatasi">Mengatasi</a></li>
        <li><a href="#angket">Tes Mental</a></li>
      </ul>
    </nav>
  </header>

  <section id="pencegahan">
    <h2 id="h2-pencegahan">Cara Pencegahan Gangguan Mental</h2>
    <ul>
      <li>Menjaga keseimbangan antara pekerjaan dan istirahat.</li>
      <li>Berolahraga secara teratur.</li>
      <li>Menjaga pola makan sehat dan tidur cukup.</li>
      <li>Berbicara dengan orang yang dipercaya saat menghadapi stres.</li>
      <li>Hindari konsumsi alkohol dan narkoba.</li>
    </ul>
  </section>

  <section id="tanda">
    <h2 id="h2-tanda">Tanda-tanda Gangguan Mental</h2>
    <ul>
      <li>Merasa sedih atau cemas berkepanjangan.</li>
      <li>Kehilangan minat terhadap aktivitas yang disukai.</li>
      <li>Perubahan nafsu makan atau pola tidur.</li>
      <li>Sulit berkonsentrasi.</li>
      <li>Menarik diri dari lingkungan sosial.</li>
    </ul>
  </section>

  <section id="mengatasi">
    <h2 id="h2-mengatasi">Cara Mengatasi Gangguan Mental</h2>
    <ul>
      <li>Konsultasi dengan psikolog atau psikiater.</li>
      <li>Terapi perilaku kognitif atau konseling.</li>
      <li>Menulis jurnal atau meditasi.</li>
      <li>Meningkatkan dukungan sosial.</li>
      <li>Berpartisipasi dalam kegiatan positif.</li>
    </ul>
  </section>

  <section id="angket">
    <h2 id="h2-angket">Tes Kesehatan Mental</h2>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <div class="tests-tabs" role="tablist" aria-label="Pilih tes">
          <button class="tab active" data-test="stres">Tes Stres (15)</button>
          <button class="tab" data-test="kecemasan">Tes Kecemasan</button>
          <button class="tab" data-test="kebahagiaan">Tes Kebahagiaan</button>
          <button class="tab" data-test="keseimbangan">Tes Keseimbangan Hidup</button>
        </div>

        <div class="theme-chooser">
          <label for="theme-select" style="font-size:0.9rem; color:#6b6b6b;">Tema Warna:</label>
          <select id="theme-select" aria-label="Pilih tema warna">
            <option value="default">Default (Blue/Pink)</option>
            <option value="pink">Pastel Pink</option>
            <option value="blue">Pastel Blue</option>
            <option value="purple">Pastel Purple</option>
            <option value="rainbow">Gradient Rainbow</option>
          </select>
        </div>
      </div>

      <div id="panels" style="margin-top:14px;">
        <div class="test-panel active" data-testpanel="stres">
          <form class="test-form" data-questions="15">
            <div style="display:flex;flex-direction:column;gap:15px;">
              <div class="questions-grid">
                </div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn" id="submitStres">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <div class="test-panel" data-testpanel="kecemasan">
          <form class="test-form" data-questions="10">
            <div style="display:flex;flex-direction:column;gap:15px;">
              <div class="questions-grid"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <div class="test-panel" data-testpanel="kebahagiaan">
          <form class="test-form" data-questions="8">
            <div style="display:flex;flex-direction:column;gap:15px;">
              <div class="questions-grid"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <div class="test-panel" data-testpanel="keseimbangan">
          <form class="test-form" data-questions="12">
            <div style="display:flex;flex-direction:column;gap:15px;">
              <div class="questions-grid"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div id="hasil-area" style="margin-top:16px; display:none;" class="card">
        <h3 id="hasil-title">Hasil Tes</h3>
        <p id="hasil-emoji" style="font-size:2rem; margin:8px 0;">üôÇ</p>
        <p id="hasil-score" style="font-weight:700;"></p>
        <p id="hasil-interpretasi"></p>
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button class="btn" id="saveLocal">Simpan Hasil <span class="hover-ico">‚ô°</span></button>
          <button class="btn" id="downloadResult" style="background:#fff;color:#333;border:1px solid #eee;">Download <span class="hover-ico">‚ú®</span></button>
        </div>
      </div>
    </div>
  </section>

  <section id="quotes" style="max-width:980px;margin:30px auto;">
    <h2 id="h2-quotes">Quotes Motivasi</h2>
    <div id="quotes-section">
      <div class="quote-display">
        <div style="margin-bottom:15px;">
            <label for="quote-select" style="font-size:0.9rem; color:#6b6b6b; display:block; margin-bottom:5px;">Pilih Kutipan:</label>
            <select id="quote-select" style="min-width:250px;">
                </select>
        </div>
        <p id="current-quote">\"Setiap langkah kecil adalah kemajuan ‚Äî beri dirimu waktu.\"</p>
        <p id="quote-author">~ Anonim</p>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 Kesehatan Mental | Dibuat dengan ‚ù§Ô∏è</p>
  </footer>

  <script>
    /**********************
     * UTIL: questions templates (placeholder texts)
     **********************/
    const sampleQs = {
      stres: [
        "Saya merasa mudah marah atau tersinggung.",
        "Saya sulit rileks.",
        "Saya merasa tertekan dengan tuntutan sehari-hari.",
        "Pikiran saya sering berputar tanpa henti.",
        "Saya merasa lelah karena beban pikiran.",
        "Saya mudah terganggu oleh hal kecil.",
        "Saya merasa tidak sabar.",
        "Saya khawatir tidak bisa menyelesaikan tugas.",
        "Saya sering merasa cemas tanpa alasan jelas.",
        "Tidur saya terganggu karena pikiran.",
        "Saya merasa tegang otot atau sakit kepala karena stres.",
        "Saya sulit berkonsentrasi.",
        "Saya khawatir berlebihan tentang masa depan.",
        "Saya merasa kewalahan ketika banyak tugas.",
        "Saya sulit menenangkan diri setelah kejadian menegangkan."
      ],
      kecemasan: [
        "Saya sering merasa cemas tanpa alasan yang jelas.",
        "Saya khawatir berlebihan terhadap hal kecil.",
        "Saya merasa gelisah di keramaian.",
        "Saya sulit tidur karena pikiran cemas.",
        "Saya khawatir tentang kesehatan saya terus-menerus.",
        "Saya merasa napas cepat saat cemas.",
        "Saya menghindari situasi karena takut cemas.",
        "Saya merasa ada yang tidak terkendali.",
        "Saya sering memikirkan kemungkinan terburuk.",
        "Saya sulit menenangkan diri saat khawatir."
      ],
      kebahagiaan: [
        "Saya merasa puas dengan hidup saya saat ini.",
        "Saya mudah merasakan kebahagiaan dalam hal sederhana.",
        "Saya merasa memiliki tujuan yang memotivasi.",
        "Saya merasa dekat dan terhubung dengan orang lain.",
        "Saya menikmati waktu sendirian tanpa merasa sedih.",
        "Saya sering tersenyum tanpa alasan khusus.",
        "Saya bersyukur atas hal-hal kecil setiap hari.",
        "Saya merasa optimis tentang masa depan."
      ],
      keseimbangan: [
        "Saya merasa pekerjaan dan kehidupan pribadi seimbang.",
        "Saya cukup tidur dan istirahat.",
        "Saya punya waktu untuk hobi dan rekreasi.",
        "Saya menjaga pola makan yang baik.",
        "Saya meluangkan waktu untuk olahraga.",
        "Saya merasa hubungan sosial saya sehat.",
        "Saya memiliki waktu untuk refleksi diri.",
        "Saya bisa mengelola stres secara rutin.",
        "Saya merasa punya dukungan saat sulit.",
        "Saya memberi waktu untuk pengembangan diri.",
        "Saya merasa bebas dari beban finansial yang berlebihan.",
        "Saya menikmati kegiatan yang menenangkan."
      ]
    };

    const quoteList = [
        { text: "Setiap langkah kecil adalah kemajuan ‚Äî beri dirimu waktu.", author: "Anonim" },
        { text: "Kebaikan pada diri sendiri bukanlah egois, itu bertahan hidup.", author: "Audre Lorde" },
        { text: "Berbicara tentang perasaan adalah keberanian, bukan kelemahan.", author: "Bren√© Brown" },
        { text: "Saat kamu merawat dirimu, kamu memberi izin untuk sembuh.", author: "Tara Brach" },
        { text: "Jalani hidup seolah-olah semua pendapatmu adalah yang terpenting.", author: "Ralph Waldo Emerson" },
        { text: "Jangan biarkan apa yang tidak bisa kamu lakukan mengganggu apa yang bisa kamu lakukan.", author: "John Wooden" },
        { text: "Satu-satunya cara untuk melakukan pekerjaan hebat adalah mencintai apa yang kamu lakukan.", author: "Steve Jobs" },
        { text: "Kebahagiaan bukan sesuatu yang sudah jadi. Itu datang dari tindakanmu sendiri.", author: "Dalai Lama" },
        { text: "Mengubah cara pandangmu terhadap hal-hal, mengubah hal-hal yang kamu pandang.", author: "Wayne Dyer" },
        { text: "Kamu lebih berani dari yang kamu yakini, lebih kuat dari yang terlihat, dan lebih pintar dari yang kamu kira.", author: "A.A. Milne (Winnie The Pooh)" }
    ];

    /**********************
     * Render questions into each panel (Modified to use SELECT)
     **********************/
    const scoreOptions = `
        <option value="1">1 - Tidak pernah</option>
        <option value="2">2 - Jarang</option>
        <option value="3">3 - Kadang-kadang</option>
        <option value="4">4 - Sering</option>
        <option value="5">5 - Sangat sering</option>
    `;

    document.querySelectorAll('.test-panel').forEach(panel=>{
      const form = panel.querySelector('.test-form');
      const grid = form.querySelector('.questions-grid');
      const qKey = panel.dataset.testpanel;
      const qArr = sampleQs[qKey] || [];
      const questionsCount = parseInt(form.dataset.questions,10) || qArr.length;

      let finalQs = [];
      for (let i=0;i<questionsCount;i++){
        finalQs.push(qArr[i % qArr.length] || `Pertanyaan ${i+1}`);
      }

      grid.innerHTML = '';
      finalQs.forEach((q,i)=>{
        const idx = i+1;
        const item = document.createElement('div');
        item.className = 'card question-item';
        item.innerHTML = `
          <label class="question-label" for="${qKey}-q${idx}">${idx}. ${q}</label>
          <div class="score-control">
            <select id="${qKey}-q${idx}" name="${qKey}-q${idx}" required data-qindex="${i}">
                ${scoreOptions}
            </select>
            <small style="color:#666;">(1=Tidak pernah, 5=Sangat sering)</small>
          </div>
        `;
        grid.appendChild(item);
      });
    });

    /**********************
     * Tabs behavior
     **********************/
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const key = t.dataset.test;
        document.querySelectorAll('.test-panel').forEach(p=>{
          p.classList.toggle('active', p.dataset.testpanel === key);
        });
        document.getElementById('hasil-area').style.display = 'none';
        // Reset inputs on switch (optional, but good UX)
        document.querySelectorAll('.test-form select').forEach(s => s.value = 1);
      });
    });

    /**********************
     * Scoring & Interpretation (common function)
     **********************/
    function interpretResult(total, questions, testKey){
      const max = questions*5;
      // we'll compute 'scorePercent' similar: healthier => higher percent (lower total for Stres/Cemas is better)
      const healthyPercent = Math.round(((max - total) / max) * 100);
      let emoji='üôÇ', title='OK', interp='';

      if (testKey === 'kebahagiaan') {
        // For 'kebahagiaan', a higher raw score (total) means better (healthier). We need to invert the formula logic for this test.
        const happinessScore = total; // 8*1 (8) to 8*5 (40)
        const min = questions*1;
        const happyPercent = Math.round(((happinessScore - min) / (max - min)) * 100);

        if (happyPercent >= 80) { emoji='ü§©'; title='Sangat Bahagia'; interp='Kamu merasa sangat bahagia. Pertahankan rasa syukur dan kebiasaan positif.'; }
        else if (happyPercent >= 50) { emoji='üòä'; title='Cukup Bahagia'; interp='Kamu cukup bahagia. Coba rutinitas kecil yang membahagiakan untuk meningkatkannya.'; }
        else { emoji='üòï'; title='Kurang Bahagia'; interp='Pertimbangkan aktivitas yang memberi makna dan meningkatkan hubungan sosial.'; }
        return { emoji, title, interp, healthyPercent: happyPercent }; // Return happyPercent as the score
      }

      // For Stres, Kecemasan, Keseimbangan: lower total = higher healthyPercent
      if (testKey === 'stres') {
        if (healthyPercent >= 80) { emoji='üòå'; title='Stres Rendah'; interp='Kamu tampak punya mekanisme koping yang baik. Pertahankan kebiasaan positif.'; }
        else if (healthyPercent >= 50) { emoji='üôÇ'; title='Stres Sedang'; interp='Perhatikan tanda-tanda stres ‚Äî coba teknik relaksasi seperti bernapas atau jalan singkat.'; }
        else { emoji='üòü'; title='Stres Tinggi'; interp='Kamu mengalami tingkat stres yang cukup tinggi. Pertimbangkan berbicara dengan orang terpercaya atau profesional.'; }
      } else if (testKey === 'kecemasan') {
        if (healthyPercent >= 80) { emoji='üòä'; title='Kecemasan Rendah'; interp='Kecemasanmu rendah. Lanjutkan aktivitas yang menenangkan.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Kecemasan Sedang'; interp='Coba teknik pernapasan, kurangi kafein, dan istirahat cukup.'; }
        else { emoji='üò∞'; title='Kecemasan Tinggi'; interp='Pertimbangkan dukungan lebih lanjut ‚Äî konsultasi profesional dapat membantu.'; }
      } else if (testKey === 'keseimbangan') {
        if (healthyPercent >= 80) { emoji='üåø'; title='Seimbang'; interp='Kehidupanmu tampak seimbang. Jaga konsistensi dan istirahat.'; }
        else if (healthyPercent >= 50) { emoji='‚öñÔ∏è'; title='Cukup Seimbang'; interp='Perhatikan area yang kurang ‚Äî coba atur jadwal dan kurangi beban.'; }
        else { emoji='üîÑ'; title='Kurang Seimbang'; interp='Pertimbangkan langkah sederhana: tidur, olahraga ringan, dan dukungan sosial.'; }
      } else {
        // Fallback for any other test
        if (healthyPercent >= 80) { emoji='üôÇ'; title='Baik'; interp='Hasil menunjukkan kondisi yang cukup baik.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Perlu Perhatian'; interp='Perlu beberapa perbaikan.'; }
        else { emoji='üòü'; title='Perhatian Lebih'; interp='Disarankan untuk mencari dukungan.'; }
      }

      return { emoji, title, interp, healthyPercent };
    }


    /**********************
     * Handle form submissions for all tests
     **********************/
    document.querySelectorAll('.test-form').forEach(form=>{
      form.addEventListener('submit', function(e){
        e.preventDefault();
        // Use select elements instead of number inputs
        const inputs = Array.from(form.querySelectorAll('select'));

        // Check for required fields (optional, but good practice)
        let isValid = true;
        inputs.forEach(inp => {
            if (!inp.value || inp.value < 1 || inp.value > 5) {
                isValid = false;
                inp.style.border = '2px solid red'; // Highlight invalid input
            } else {
                inp.style.border = '1px solid #ddd'; // Reset border
            }
        });

        if (!isValid) {
            alert("Harap isi semua pertanyaan dengan skor 1 sampai 5.");
            return;
        }

        let total = 0;
        inputs.forEach(inp=>{
          let v = parseInt(inp.value,10);
          total += v;
        });

        const activePanel = form.closest('.test-panel');
        const testKey = activePanel ? activePanel.dataset.testpanel : 'test';
        const questions = inputs.length;

        const res = interpretResult(total, questions, testKey);

        // show hasil-area
        document.getElementById('hasil-area').style.display = 'block';
        document.getElementById('hasil-title').textContent = res.title + ' ‚Äî ' + testKey.charAt(0).toUpperCase() + testKey.slice(1);
        document.getElementById('hasil-emoji').textContent = res.emoji;
        document.getElementById('hasil-score').textContent = `Skor kesehatan (lebih tinggi = lebih baik): ${res.healthyPercent}%`;
        document.getElementById('hasil-interpretasi').textContent = res.interp;

        // store last result in DOM for save/download
        document.getElementById('hasil-area').dataset.lastResult = JSON.stringify({
          testKey, total, questions, ...res, timestamp: new Date().toISOString()
        });

        // scroll into view
        document.getElementById('hasil-area').scrollIntoView({behavior:'smooth'});
      });
    });

    /**********************
     * Reset buttons per panel
     **********************/
    document.querySelectorAll('.btn-reset').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const form = btn.closest('.test-panel').querySelector('.test-form');
        // Reset select value to 1
        form.querySelectorAll('select').forEach(i=>{
            i.value = 1;
            i.style.border = '1px solid #ddd'; // Reset border
        });
        document.getElementById('hasil-area').style.display = 'none';
      });
    });

    /**********************
     * Save result locally (localStorage)
     **********************/
    document.getElementById('saveLocal').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk disimpan.'); return; }
      const results = JSON.parse(localStorage.getItem('mh_results') || '[]');
      results.push(JSON.parse(last));
      localStorage.setItem('mh_results', JSON.stringify(results));
      alert('Hasil tersimpan (local).');
    });

    /**********************
     * Download result as text
     **********************/
    document.getElementById('downloadResult').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk didownload.'); return; }
      const data = JSON.parse(last);
      const content = `Hasil Tes: ${data.testKey}\nWaktu: ${data.timestamp}\nSkor: ${data.healthyPercent}%\nInterpretasi: ${data.interp}\nEmoji: ${data.emoji}\n`;
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `hasil-${data.testKey}.txt`; document.body.appendChild(a);
      a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    /**********************
     * QUOTES dropdown behavior
     **********************/
    const quoteSelect = document.getElementById('quote-select');
    const currentQuote = document.getElementById('current-quote');
    const quoteAuthor = document.getElementById('quote-author');

    quoteList.forEach((q, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `"${q.text.substring(0, 40)}..." - ${q.author}`;
        quoteSelect.appendChild(option);
    });

    // Set initial quote
    currentQuote.textContent = `"${quoteList[0].text}"`;
    quoteAuthor.textContent = `~ ${quoteList[0].author}`;

    quoteSelect.addEventListener('change', function(){
        const selectedIndex = parseInt(this.value, 10);
        const q = quoteList[selectedIndex];
        currentQuote.textContent = `"${q.text}"`;
        quoteAuthor.textContent = `~ ${q.author}`;
    });

    /**********************
     * Theme chooser: apply themes via data-attributes
     **********************/
    const themeSelect = document.getElementById('theme-select');
    const headerElement = document.getElementById('main-header');
    const h2Elements = document.querySelectorAll('h2');
    const buttons = document.querySelectorAll('button, .btn');
    const body = document.body;

    // Apply initial theme (default theme has no data-theme attr)
    function applyTheme(theme) {
        // Reset all data-theme attributes
        body.removeAttribute('data-theme');
        headerElement.removeAttribute('data-theme');
        h2Elements.forEach(h => h.removeAttribute('data-theme'));
        buttons.forEach(b => b.removeAttribute('data-theme'));

        if (theme !== 'default') {
            body.setAttribute('data-theme', theme);
            headerElement.setAttribute('data-theme', theme);
            h2Elements.forEach(h => h.setAttribute('data-theme', theme));
            buttons.forEach(b => b.setAttribute('data-theme', theme));
        }

        // Handle specific header text color for rainbow (since it's a light gradient)
        document.querySelector('header h1').style.color = (theme === 'rainbow') ? '#333' : 'white';
        document.querySelectorAll('nav ul li a').forEach(a => a.style.color = (theme === 'rainbow') ? '#333' : 'white');
    }

    themeSelect.addEventListener('change', (e) => {
        applyTheme(e.target.value);
    });

    /**********************
     * Extra: small keyboard accessibility for tabs
     **********************/
    document.querySelectorAll('.tab').forEach((t, i, list) => {
      t.setAttribute('tabindex','0');
      t.addEventListener('keydown', (e)=>{
        if (e.key === 'ArrowRight') { list[(i+1)%list.length].focus(); e.preventDefault(); }
        if (e.key === 'ArrowLeft') { list[(i-1+list.length)%list.length].focus(); e.preventDefault(); }
        if (e.key === 'Enter' || e.key === ' ') t.click();
      });
    });

    // Initialize the default theme settings
    applyTheme('default');
  </script>
</body>
</html>