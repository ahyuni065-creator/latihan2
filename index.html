<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kesehatan Mental</title>

  <!-- Jika kamu masih punya style.css, file ini tetap akan dipakai.
       Namun semua override untuk fitur baru diletakkan di <style> supaya gampang dipakai langsung. -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* ==============================
       BASE OVERRIDES: tetap jaga struktur awal
       ============================== */
    * { box-sizing: border-box; margin:0; padding:0; font-family: "Poppins", "Segoe UI", Roboto, sans-serif; }
    body { color: #333; line-height:1.6; min-height:100vh; position:relative; overflow-x:hidden; }

    /* Pastel background utama + slow gradient */
    body::before{
      content: "";
      position: fixed;
      inset: 0;
      z-index: -100;
      background: linear-gradient(135deg, #f7f9ff 0%, #f2f7ff 40%, #fff4fb 100%);
    }

    /* Header - sekarang bergradien biru->pink (tetap kotak) */
    header {
      background: linear-gradient(90deg, #7aa3ff 0%, #ffb3d9 100%);
      color: white;
      padding: 1rem 0;
      text-align: center;
      position: relative;
      overflow: visible;
    }
    header h1 { margin-bottom: 8px; font-size: 1.8rem; }

    nav ul { list-style:none; display:flex; justify-content:center; gap:18px; flex-wrap:wrap; margin-top:6px; }
    nav ul li a { color:white; text-decoration:none; font-weight:600; padding:6px 8px; display:inline-block; }

    section { padding: 40px 20px; max-width: 900px; margin: 20px auto; background: transparent; }

    h2 { color: #7aa3ff; margin-bottom:10px; }

    form { margin-top:20px; background: white; padding:18px; border-radius:12px; box-shadow: 0 6px 18px rgba(30,40,80,0.06); }

    .question { margin-bottom:12px; }
    input[type="number"]{ width:80px; padding:8px; border-radius:6px; border:1px solid #ddd; }

    button, .btn {
      background: #9ebdff;
      color:white;
      padding:10px 16px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      position:relative;
      overflow:visible;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    button:hover, .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(32,48,120,0.12); }

    #hasil { margin-top:18px; background:#eaf2ff; padding:14px; border-radius:10px; }

    footer { text-align:center; background:transparent; color:#666; padding:18px 10px; margin-top:40px; }

    /* ==============================
       Cute icon on hover (‚ú® / ‚ô°)
       ============================== */
    .btn .hover-ico, button .hover-ico {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%) translateX(6px);
      opacity: 0;
      pointer-events:none;
      transition: transform .25s cubic-bezier(.2,.9,.3,1), opacity .2s;
      font-size:18px;
    }
    button:hover .hover-ico, .btn:hover .hover-ico { opacity:1; transform: translateY(-50%) translateX(0); }

    /* Slight pastel shadows for cards */
    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 6px 18px rgba(30,40,80,0.05);
    }

    /* ==============================
       Multiple tests layout (tabs)
       ============================== */
    .tests-tabs { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px; }
    .tab {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      padding:8px 12px;
      border-radius:999px;
      backdrop-filter: blur(6px);
      cursor:pointer;
      color:#3a5fbf;
      font-weight:600;
    }
    .tab.active { background:linear-gradient(90deg,#9ebdff,#ffb3d9); color:white; }

    .test-panel { display:none; }
    .test-panel.active { display:block; }

    /* ==============================
       QUOTES SLIDER (pastel background + fade)
       ============================== */
    #quotes-section { padding: 30px 20px; border-radius:12px; background: linear-gradient(180deg,#fff8fe,#f7fbff); box-shadow: 0 6px 18px rgba(30,40,80,0.03); }
    .quotes-wrap { max-width:700px; margin:0 auto; position:relative; min-height:100px; }
    .quote { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; text-align:center; padding:18px; opacity:0; transform: translateY(8px); transition: all .6s ease; color:#333; font-weight:600; font-size:1.05rem; }
    .quote.active { opacity:1; transform: translateY(0); z-index:2; }

    .quotes-controls { margin-top:12px; display:flex; justify-content:center; gap:8px; }

    /* ==============================
       Clouds animation (soft) - fixed in background
       ============================== */
    .clouds {
      position: fixed;
      inset: 0;
      z-index: -90;
      pointer-events: none;
      overflow: hidden;
    }
    .cloud {
      position: absolute;
      background: linear-gradient(180deg,#ffffffcc,#fff0ffcc);
      border-radius: 50%;
      filter: blur(6px);
      opacity: .85;
      animation: floatCloud 40s linear infinite;
      transform: translateY(0);
    }
    .cloud.c1 { width: 360px; height:110px; top: 20%; left:-20%; animation-duration:48s; }
    .cloud.c2 { width: 260px; height:80px; top: 40%; left:-30%; animation-duration:60s; animation-delay:5s; }
    .cloud.c3 { width: 420px; height:130px; top: 70%; left:-40%; animation-duration:72s; animation-delay:8s; }
    @keyframes floatCloud {
      0% { transform: translateX(-10vw) translateY(0); }
      50% { transform: translateX(110vw) translateY(-8px); }
      100% { transform: translateX(230vw) translateY(0); }
    }

    /* ==============================
       Header sparkles
       ============================== */
    .sparkle {
      position: absolute;
      width:8px; height:8px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #fff7 20%, transparent 60%);
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(255,255,255,0.6);
      opacity: .9;
      transform-origin:center;
      animation: sparkleAnim 2.6s linear infinite;
      pointer-events:none;
    }
    .sparkle.s1 { top: 16px; left: 12%; animation-delay:0s; }
    .sparkle.s2 { top: 8px; left: 24%; animation-delay:.6s; }
    .sparkle.s3 { top: 24px; left: 70%; animation-delay:1.1s; }
    @keyframes sparkleAnim {
      0% { transform: scale(.6) translateY(0); opacity:.2; }
      40% { transform: scale(1.6) translateY(-6px); opacity:1; }
      100% { transform: scale(.6) translateY(0); opacity:.2; }
    }

    /* ==============================
       Theme chooser (Gradient Rainbow pastel)
       ============================== */
    .theme-chooser { display:flex; gap:8px; align-items:center; justify-content:center; margin:14px 0; }
    .theme-swatch {
      width:38px; height:28px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.06);
      box-shadow: 0 6px 14px rgba(0,0,0,0.06);
    }
    .sw-rainbow { background: linear-gradient(90deg,#ffd6f0,#dbe9ff,#e8fef8,#fff7d6,#ffdfe8); }

    /* ==============================
       Small responsiveness
       ============================== */
    @media (max-width:720px){
      header h1 { font-size:1.4rem; }
      nav ul { gap:10px; font-size:0.95rem; }
      .cloud.c1, .cloud.c2, .cloud.c3 { display:block; opacity:.6; }
    }

  </style>
</head>
<body>

  <!-- MOVING CLOUDS -->
  <div class="clouds" aria-hidden="true">
    <div class="cloud c1" style="left:-30%; top:8%;"></div>
    <div class="cloud c2" style="left:-40%; top:38%;"></div>
    <div class="cloud c3" style="left:-50%; top:68%;"></div>
  </div>

  <header>
    <div class="sparkle s1" aria-hidden="true"></div>
    <div class="sparkle s2" aria-hidden="true"></div>
    <div class="sparkle s3" aria-hidden="true"></div>

    <h1>Kesehatan Mental</h1>

    <nav>
      <ul>
        <li><a href="#pencegahan">Pencegahan</a></li>
        <li><a href="#tanda">Tanda-tanda</a></li>
        <li><a href="#mengatasi">Mengatasi</a></li>
        <li><a href="#angket">Tes Mental</a></li>
      </ul>
    </nav>
  </header>

  <!-- =========================
       MAIN CONTENT (tetap struktur lama)
       ========================= -->
  <section id="pencegahan">
    <h2>Cara Pencegahan Gangguan Mental</h2>
    <ul>
      <li>Menjaga keseimbangan antara pekerjaan dan istirahat.</li>
      <li>Berolahraga secara teratur.</li>
      <li>Menjaga pola makan sehat dan tidur cukup.</li>
      <li>Berbicara dengan orang yang dipercaya saat menghadapi stres.</li>
      <li>Hindari konsumsi alkohol dan narkoba.</li>
    </ul>
  </section>

  <section id="tanda">
    <h2>Tanda-tanda Gangguan Mental</h2>
    <ul>
      <li>Merasa sedih atau cemas berkepanjangan.</li>
      <li>Kehilangan minat terhadap aktivitas yang disukai.</li>
      <li>Perubahan nafsu makan atau pola tidur.</li>
      <li>Sulit berkonsentrasi.</li>
      <li>Menarik diri dari lingkungan sosial.</li>
    </ul>
  </section>

  <section id="mengatasi">
    <h2>Cara Mengatasi Gangguan Mental</h2>
    <ul>
      <li>Konsultasi dengan psikolog atau psikiater.</li>
      <li>Terapi perilaku kognitif atau konseling.</li>
      <li>Menulis jurnal atau meditasi.</li>
      <li>Meningkatkan dukungan sosial.</li>
      <li>Berpartisipasi dalam kegiatan positif.</li>
    </ul>
  </section>

  <!-- =========================
       TES MENTAL (baru: banyak tes + tab)
       ========================= -->
  <section id="angket">
    <h2>Tes Kesehatan Mental</h2>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <div class="tests-tabs" role="tablist" aria-label="Pilih tes">
          <button class="tab active" data-test="stres">Tes Stres (15)</button>
          <button class="tab" data-test="kecemasan">Tes Kecemasan</button>
          <button class="tab" data-test="kebahagiaan">Tes Kebahagiaan</button>
          <button class="tab" data-test="keseimbangan">Tes Keseimbangan Hidup</button>
        </div>

        <!-- theme chooser -->
        <div class="theme-chooser" aria-hidden="false">
          <div style="font-size:0.9rem; color:#6b6b6b;">Tema</div>
          <div class="theme-swatch sw-rainbow" id="sw-rainbow" title="Gradient Rainbow pastel" role="button" aria-label="Pilih tema pelangi"></div>
          <button class="btn" id="resetTheme" title="Kembali tema default" style="background:#fff;color:#333;border:1px solid #eee;">
            Reset
            <span class="hover-ico">‚ô°</span>
          </button>
        </div>
      </div>

      <!-- FORM PANELS -->
      <div id="panels" style="margin-top:14px;">
        <!-- STRES (15 pertanyaan) -->
        <div class="test-panel active" data-testpanel="stres">
          <form class="test-form" data-questions="15">
            <div style="display:flex;flex-direction:column;gap:10px;">
              <!-- generate 15 questions simple -->
              <div class="questions-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;">
                <!-- JS akan mengisi, tapi sediakan fallback five sample -->
              </div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn" id="resetStres" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <!-- KECEMASAN (10) -->
        <div class="test-panel" data-testpanel="kecemasan">
          <form class="test-form" data-questions="10">
            <div style="display:flex;flex-direction:column;gap:10px;">
              <div class="questions-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <!-- KEBAHAGIAAN (8) -->
        <div class="test-panel" data-testpanel="kebahagiaan">
          <form class="test-form" data-questions="8">
            <div style="display:flex;flex-direction:column;gap:10px;">
              <div class="questions-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>

        <!-- KESEIMBANGAN (12) -->
        <div class="test-panel" data-testpanel="keseimbangan">
          <form class="test-form" data-questions="12">
            <div style="display:flex;flex-direction:column;gap:10px;">
              <div class="questions-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:10px;"></div>
              <div style="display:flex;gap:10px; margin-top:8px;">
                <button type="submit" class="btn">Lihat Hasil <span class="hover-ico">‚ú®</span></button>
                <button type="button" class="btn btn-reset" style="background:#fff;color:#333;border:1px solid #eee;">Reset <span class="hover-ico">‚ô°</span></button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- hasil area (sama untuk semua tes, JS akan menulis) -->
      <div id="hasil-area" style="margin-top:16px; display:none;" class="card">
        <h3 id="hasil-title">Hasil Tes</h3>
        <p id="hasil-emoji" style="font-size:2rem; margin:8px 0;">üôÇ</p>
        <p id="hasil-score" style="font-weight:700;"></p>
        <p id="hasil-interpretasi"></p>
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button class="btn" id="saveLocal">Simpan Hasil <span class="hover-ico">‚ô°</span></button>
          <button class="btn" id="downloadResult" style="background:#fff;color:#333;border:1px solid #eee;">Download <span class="hover-ico">‚ú®</span></button>
        </div>
      </div>
    </div>
  </section>

  <!-- =========================
       QUOTES MOTIVASI (slider fade)
       ========================= -->
  <section id="quotes" style="max-width:980px;margin:30px auto;">
    <h2>Quotes Motivasi</h2>
    <div id="quotes-section">
      <div class="quotes-wrap">
        <div class="quote active">\"Setiap langkah kecil adalah kemajuan ‚Äî beri dirimu waktu.\"</div>
        <div class="quote">\"Kebaikan pada diri sendiri bukanlah egois, itu bertahan hidup.\"</div>
        <div class="quote">\"Berbicara tentang perasaan adalah keberanian, bukan kelemahan.\"</div>
        <div class="quote">\"Saat kamu merawat dirimu, kamu memberi izin untuk sembuh.\"</div>
      </div>

      <div class="quotes-controls">
        <button class="btn" id="prevQuote">‚ü®</button>
        <button class="btn" id="nextQuote">‚ü©</button>
      </div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 Kesehatan Mental | Dibuat dengan ‚ù§Ô∏è</p>
  </footer>

  <!-- =========================
       SCRIPT: generate questions, handle tests, results, quotes, theme
       ========================= -->
  <script>
    /**********************
     * UTIL: questions templates (placeholder texts)
     **********************/
    const sampleQs = {
      stres: [
        "Saya merasa mudah marah atau tersinggung.",
        "Saya sulit rileks.",
        "Saya merasa tertekan dengan tuntutan sehari-hari.",
        "Pikiran saya sering berputar tanpa henti.",
        "Saya merasa lelah karena beban pikiran.",
        "Saya mudah terganggu oleh hal kecil.",
        "Saya merasa tidak sabar.",
        "Saya khawatir tidak bisa menyelesaikan tugas.",
        "Saya sering merasa cemas tanpa alasan jelas.",
        "Tidur saya terganggu karena pikiran.",
        "Saya merasa tegang otot atau sakit kepala karena stres.",
        "Saya sulit berkonsentrasi.",
        "Saya khawatir berlebihan tentang masa depan.",
        "Saya merasa kewalahan ketika banyak tugas.",
        "Saya sulit menenangkan diri setelah kejadian menegangkan."
      ],
      kecemasan: [
        "Saya sering merasa cemas tanpa alasan yang jelas.",
        "Saya khawatir berlebihan terhadap hal kecil.",
        "Saya merasa gelisah di keramaian.",
        "Saya sulit tidur karena pikiran cemas.",
        "Saya khawatir tentang kesehatan saya terus-menerus.",
        "Saya merasa napas cepat saat cemas.",
        "Saya menghindari situasi karena takut cemas.",
        "Saya merasa ada yang tidak terkendali.",
        "Saya sering memikirkan kemungkinan terburuk.",
        "Saya sulit menenangkan diri saat khawatir."
      ],
      kebahagiaan: [
        "Saya merasa puas dengan hidup saya saat ini.",
        "Saya mudah merasakan kebahagiaan dalam hal sederhana.",
        "Saya merasa memiliki tujuan yang memotivasi.",
        "Saya merasa dekat dan terhubung dengan orang lain.",
        "Saya menikmati waktu sendirian tanpa merasa sedih.",
        "Saya sering tersenyum tanpa alasan khusus.",
        "Saya bersyukur atas hal-hal kecil setiap hari.",
        "Saya merasa optimis tentang masa depan."
      ],
      keseimbangan: [
        "Saya merasa pekerjaan dan kehidupan pribadi seimbang.",
        "Saya cukup tidur dan istirahat.",
        "Saya punya waktu untuk hobi dan rekreasi.",
        "Saya menjaga pola makan yang baik.",
        "Saya meluangkan waktu untuk olahraga.",
        "Saya merasa hubungan sosial saya sehat.",
        "Saya memiliki waktu untuk refleksi diri.",
        "Saya bisa mengelola stres secara rutin.",
        "Saya merasa punya dukungan saat sulit.",
        "Saya memberi waktu untuk pengembangan diri.",
        "Saya merasa bebas dari beban finansial yang berlebihan.",
        "Saya menikmati kegiatan yang menenangkan."
      ]
    };

    /**********************
     * Render questions into each panel
     **********************/
    document.querySelectorAll('.test-panel').forEach(panel=>{
      const form = panel.querySelector('.test-form');
      const grid = form.querySelector('.questions-grid');
      const qKey = panel.dataset.testpanel;
      const qArr = sampleQs[qKey] || [];
      const questionsCount = parseInt(form.dataset.questions,10) || qArr.length;

      // ensure we have enough questions (if specified count > available, reuse)
      let finalQs = [];
      for (let i=0;i<questionsCount;i++){
        finalQs.push(qArr[i % qArr.length] || `Pertanyaan ${i+1}`);
      }

      // populate
      grid.innerHTML = '';
      finalQs.forEach((q,i)=>{
        const idx = i+1;
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `
          <label style="display:block;font-weight:600;margin-bottom:6px;">${idx}. ${q}</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <input type="number" min="1" max="5" required value="1" data-qindex="${i}" />
            <small style="color:#666;">(1=Tidak pernah, 5=Sangat sering)</small>
          </div>
        `;
        grid.appendChild(item);
      });
    });

    /**********************
     * Tabs behavior
     **********************/
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');

        const key = t.dataset.test;
        document.querySelectorAll('.test-panel').forEach(p=>{
          p.classList.toggle('active', p.dataset.testpanel === key);
        });

        // hide hasil-area on switching
        document.getElementById('hasil-area').style.display = 'none';
      });
    });

    /**********************
     * Scoring & Interpretation (common function)
     * - Score range: min=questions*1, max=questions*5
     * - We convert to percent-like health where lower total means healthier (like earlier logic)
     **********************/
    function interpretResult(total, questions, testKey){
      const max = questions*5;
      // we'll compute 'scorePercent' similar: healthier => higher percent
      const healthyPercent = Math.round(((max - total) / max) * 100);

      let emoji='üôÇ', title='OK', interp='';
      // customize message per test type (testKey)
      if (testKey === 'stres') {
        if (healthyPercent >= 80) { emoji='üòå'; title='Stres Rendah'; interp='Kamu tampak punya mekanisme koping yang baik. Pertahankan kebiasaan positif.'; }
        else if (healthyPercent >= 50) { emoji='üôÇ'; title='Stres Sedang'; interp='Perhatikan tanda-tanda stres ‚Äî coba teknik relaksasi seperti bernapas atau jalan singkat.'; }
        else { emoji='üòü'; title='Stres Tinggi'; interp='Kamu mengalami tingkat stres yang cukup tinggi. Pertimbangkan berbicara dengan orang terpercaya atau profesional.'; }
      } else if (testKey === 'kecemasan') {
        if (healthyPercent >= 80) { emoji='üòä'; title='Kecemasan Rendah'; interp='Kecemasanmu rendah. Lanjutkan aktivitas yang menenangkan.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Kecemasan Sedang'; interp='Coba teknik pernapasan, kurangi kafein, dan istirahat cukup.'; }
        else { emoji='üò∞'; title='Kecemasan Tinggi'; interp='Pertimbangkan dukungan lebih lanjut ‚Äî konsultasi profesional dapat membantu.'; }
      } else if (testKey === 'kebahagiaan') {
        // higher healthyPercent => happier
        if (healthyPercent >= 80) { emoji='ü§©'; title='Sangat Bahagia'; interp='Kamu merasa bahagia ‚Äî pertahankan rasa syukur dan kebiasaan positif.'; }
        else if (healthyPercent >= 50) { emoji='üòä'; title='Cukup Bahagia'; interp='Ada area yang bisa ditingkatkan ‚Äî coba rutinitas kecil yang membahagiakan.'; }
        else { emoji='üòï'; title='Kurang Bahagia'; interp='Pertimbangkan aktivitas yang memberi makna dan hubungan sosial.'; }
      } else if (testKey === 'keseimbangan') {
        if (healthyPercent >= 80) { emoji='üåø'; title='Seimbang'; interp='Kehidupanmu tampak seimbang. Jaga konsistensi dan istirahat.'; }
        else if (healthyPercent >= 50) { emoji='‚öñÔ∏è'; title='Cukup Seimbang'; interp='Perhatikan area yang kurang ‚Äî coba atur jadwal dan kurangi beban.'; }
        else { emoji='üîÑ'; title='Kurang Seimbang'; interp='Pertimbangkan langkah sederhana: tidur, olahraga ringan, dan dukungan sosial.'; }
      } else {
        if (healthyPercent >= 80) { emoji='üôÇ'; title='Baik'; interp='Hasil menunjukkan kondisi yang cukup baik.'; }
        else if (healthyPercent >= 50) { emoji='üòê'; title='Perlu Perhatian'; interp='Perlu beberapa perbaikan.'; }
        else { emoji='üòü'; title='Perhatian Lebih'; interp='Disarankan untuk mencari dukungan.'; }
      }

      return { emoji, title, interp, healthyPercent };
    }

    /**********************
     * Handle form submissions for all tests
     **********************/
    document.querySelectorAll('.test-form').forEach(form=>{
      form.addEventListener('submit', function(e){
        e.preventDefault();
        const inputs = Array.from(form.querySelectorAll('input[type="number"]'));
        // ensure values parsed
        let total = 0;
        inputs.forEach(inp=>{
          let v = parseInt(inp.value,10);
          if (isNaN(v) || v<1) v=1;
          if (v>5) v=5;
          total += v;
        });
        // identify active test key
        const activePanel = form.closest('.test-panel');
        const testKey = activePanel ? activePanel.dataset.testpanel : 'test';
        const questions = inputs.length;

        const res = interpretResult(total, questions, testKey);

        // show hasil-area
        document.getElementById('hasil-area').style.display = 'block';
        document.getElementById('hasil-title').textContent = res.title + ' ‚Äî ' + testKey.charAt(0).toUpperCase() + testKey.slice(1);
        document.getElementById('hasil-emoji').textContent = res.emoji;
        document.getElementById('hasil-score').textContent = `Skor kesehatan (lebih tinggi = lebih baik): ${res.healthyPercent}%`;
        document.getElementById('hasil-interpretasi').textContent = res.interp;

        // store last result in DOM for save/download
        document.getElementById('hasil-area').dataset.lastResult = JSON.stringify({
          testKey, total, questions, ...res, timestamp: new Date().toISOString()
        });

        // scroll into view
        document.getElementById('hasil-area').scrollIntoView({behavior:'smooth'});
      });
    });

    /**********************
     * Reset buttons per panel
     **********************/
    document.querySelectorAll('.btn-reset, #resetStres').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const form = btn.closest('.test-panel').querySelector('.test-form');
        form.querySelectorAll('input[type="number"]').forEach(i=>i.value = 1);
        document.getElementById('hasil-area').style.display = 'none';
      });
    });

    /**********************
     * Save result locally (localStorage)
     **********************/
    document.getElementById('saveLocal').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk disimpan.'); return; }
      const results = JSON.parse(localStorage.getItem('mh_results') || '[]');
      results.push(JSON.parse(last));
      localStorage.setItem('mh_results', JSON.stringify(results));
      alert('Hasil tersimpan (local).');
    });

    /**********************
     * Download result as text
     **********************/
    document.getElementById('downloadResult').addEventListener('click', ()=>{
      const area = document.getElementById('hasil-area');
      const last = area.dataset.lastResult;
      if (!last) { alert('Belum ada hasil untuk didownload.'); return; }
      const data = JSON.parse(last);
      const content = `Hasil Tes: ${data.testKey}\nWaktu: ${data.timestamp}\nSkor: ${data.healthyPercent}%\nInterpretasi: ${data.interp}\nEmoji: ${data.emoji}\n`;
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `hasil-${data.testKey}.txt`; document.body.appendChild(a);
      a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    /**********************
     * QUOTES slider behavior (fade)
     **********************/
    (function(){
      const quotes = Array.from(document.querySelectorAll('.quote'));
      let idx = 0;
      const show = (i)=>{
        quotes.forEach((q,j)=> q.classList.toggle('active', i===j));
      };
      document.getElementById('nextQuote').addEventListener('click', ()=>{
        idx = (idx+1) % quotes.length; show(idx);
      });
      document.getElementById('prevQuote').addEventListener('click', ()=>{
        idx = (idx-1 + quotes.length) % quotes.length; show(idx);
      });
      // auto rotate every 6s
      setInterval(()=>{ idx = (idx+1) % quotes.length; show(idx); }, 6000);
    })();

    /**********************
     * Theme chooser: apply gradient rainbow pastel
     **********************/
    const swRainbow = document.getElementById('sw-rainbow');
    const resetBtn = document.getElementById('resetTheme');

    swRainbow.addEventListener('click', ()=>{
      // apply gradient to body background and buttons subtly
      document.body.style.setProperty('--theme-applied','rainbow');
      document.body.style.background = 'linear-gradient(135deg,#fff6fb,#f0fbff,#fffdf6)';
      document.querySelectorAll('header').forEach(h => h.style.background = 'linear-gradient(90deg,#ffd6f0,#dbe9ff,#e8fef8,#fff7d6,#ffdfe8)');
      // change button hues slightly
      document.querySelectorAll('button, .btn').forEach(b=>{
        b.style.background = 'linear-gradient(90deg,#ffd6f0,#dbe9ff)';
        b.style.color = '#2b2b2b';
      });
    });

    resetBtn.addEventListener('click', ()=>{
      // reset to default header gradient
      document.querySelectorAll('header').forEach(h => h.style.background = 'linear-gradient(90deg, #7aa3ff 0%, #ffb3d9 100%)');
      document.querySelectorAll('button, .btn').forEach(b=>{
        b.style.background = ''; b.style.color = '';
      });
      document.body.style.background = '';
    });

    /**********************
     * Extra: small keyboard accessibility for tabs
     **********************/
    document.querySelectorAll('.tab').forEach((t, i, list) => {
      t.setAttribute('tabindex','0');
      t.addEventListener('keydown', (e)=>{
        if (e.key === 'ArrowRight') list[(i+1)%list.length].focus();
        if (e.key === 'ArrowLeft') list[(i-1+list.length)%list.length].focus();
        if (e.key === 'Enter' || e.key === ' ') t.click();
      });
    });

    /**********************
     * Initialize small defaults: set numeric inputs min1
     **********************/
    document.querySelectorAll('input[type="number"]').forEach(i=>{
      i.addEventListener('input', ()=> {
        let v = parseInt(i.value,10);
        if (isNaN(v) || v < 1) i.value = 1;
        if (v > 5) i.value = 5;
      });
    });
  </script>
</body>
</html>
